%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#10B981', 'primaryTextColor': '#fff', 'lineColor': '#34D399'}}}%%

flowchart LR
    subgraph INPUT["ðŸ“¥ ìž…ë ¥"]
        Q[ì‚¬ìš©ìž ì§ˆë¬¸]
        P[ì‚¬ìš©ìž í”„ë¡œí•„]
    end

    subgraph EMBEDDING["ðŸ”¢ ìž„ë² ë”©"]
        E1[Query Embedding]
        E2[Google Embedding API]
    end

    subgraph RETRIEVAL["ðŸ” ê²€ìƒ‰"]
        V[(ChromaDB)]
        S[Similarity Search]
        R[Top-K Documents]
    end

    subgraph GENERATION["âœ¨ ìƒì„±"]
        C[Context êµ¬ì„±]
        PR[Prompt ìƒì„±]
        LLM[Gemini LLM]
    end

    subgraph OUTPUT["ðŸ“¤ ì¶œë ¥"]
        A[Answer]
        SR[Sources]
        CF[Confidence]
    end

    Q --> E1
    E1 --> E2
    E2 --> S
    V --> S
    S --> R
    R --> C
    P --> C
    C --> PR
    PR --> LLM
    LLM --> A
    R --> SR
    S --> CF

    style INPUT fill:#DBEAFE,stroke:#3B82F6
    style EMBEDDING fill:#D1FAE5,stroke:#10B981
    style RETRIEVAL fill:#FEF3C7,stroke:#F59E0B
    style GENERATION fill:#EDE9FE,stroke:#8B5CF6
    style OUTPUT fill:#FCE7F3,stroke:#EC4899

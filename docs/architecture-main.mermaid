%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#4F46E5', 'primaryTextColor': '#fff', 'primaryBorderColor': '#4338CA', 'lineColor': '#6366F1', 'secondaryColor': '#10B981', 'tertiaryColor': '#F3F4F6'}}}%%

flowchart TB
    subgraph USER["ğŸ‘¤ ì‚¬ìš©ì"]
        U1[ì›¹ ë¸Œë¼ìš°ì €]
    end

    subgraph FRONTEND["ğŸ–¥ï¸ Frontend Layer"]
        ST[Streamlit App]
        ST --> |ì±„íŒ… UI| CHAT[ğŸ’¬ AI ìƒë‹´]
        ST --> |ì…ë ¥ í¼| INPUT[ğŸ“ ê±´ê°• ë°ì´í„° ì…ë ¥]
        ST --> |ì‹œê°í™”| VIZ[ğŸ“Š ë¶„ì„ ê²°ê³¼]
    end

    subgraph BACKEND["ğŸŒ Backend Layer - FastAPI"]
        API[API Server :8000]
        API --> EP1["/chat"]
        API --> EP2["/analyze"]
        API --> EP3["/stats"]
    end

    subgraph AI["ğŸ¤– AI/ML Layer"]
        subgraph RAG["ğŸ” RAG Module"]
            KB[Knowledge Base]
            EMB[Embedding]
            SEARCH[Vector Search]
            GEN[Answer Generation]
        end
        
        subgraph XAI["ğŸ’¡ XAI Module"]
            ANALYZE[Health Analysis]
            CONTRIB[ê¸°ì—¬ë„ ê³„ì‚°]
            EXPLAIN[ì„¤ëª… ìƒì„±]
        end
    end

    subgraph EXTERNAL["â˜ï¸ External Services"]
        GEMINI[Google Gemini API]
    end

    subgraph DATA["ğŸ—„ï¸ Data Layer"]
        CHROMA[(ChromaDB)]
        FOODS[(ìŒì‹ DB)]
        EXERCISE[(ìš´ë™ DB)]
        GUIDE[(ê°€ì´ë“œë¼ì¸)]
    end

    U1 <--> ST
    ST <--> API
    EP1 <--> RAG
    EP2 <--> XAI
    RAG <--> GEMINI
    RAG <--> CHROMA
    CHROMA --- FOODS
    CHROMA --- EXERCISE
    CHROMA --- GUIDE

    style USER fill:#EEF2FF,stroke:#4F46E5
    style FRONTEND fill:#F0FDF4,stroke:#10B981
    style BACKEND fill:#FEF3C7,stroke:#F59E0B
    style AI fill:#EDE9FE,stroke:#8B5CF6
    style EXTERNAL fill:#DBEAFE,stroke:#3B82F6
    style DATA fill:#F3F4F6,stroke:#6B7280

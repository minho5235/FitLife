"""
FitLife AI - 통합 데이터 로더 (API + 동영상)
이 스크립트 하나로 모든 데이터를 Supabase에 업로드합니다.
"""
import sys
from pathlib import Path

# 프로젝트 루트 경로 설정
project_root = Path(__file__).parent
sys.path.insert(0, str(project_root))

from src.data.public_data_loader import PublicDataLoader

def main():
    print("=" * 60)
    print("🚀 FitLife AI - 지식베이스 데이터 통합 업로드")
    print("=" * 60)
    
    loader = PublicDataLoader()
    
    # ★ [핵심] 여기에 초기화 코드를 추가하세요!
    print("\n🧹 [중복 방지] 기존 데이터를 모두 삭제하고 새로 시작합니다...")
    loader.kb.clear()

    # ---------------------------------------------------------
    # 1. [API] 건강 식재료 데이터 자동 수집
    # ---------------------------------------------------------
    print("\n[단계 1/2] 식품안전나라 API 데이터 수집")
    
    # 엄선된 건강 식재료 리스트
    target_foods = [
        # === 1. 탄수화물 (GI지수가 낮거나 영양가 높은 곡물) ===
        "현미", "현미밥", "고구마", "귀리", "오트밀", "통밀빵", "호밀빵",
        "단호박", "감자", "메밀", "메밀면", "퀴노아", "렌틸콩", "병아리콩",
        "옥수수", "보리밥", "잡곡밥", "곤약", "곤약쌀",
        
        # === 2. 단백질 (육류/가금류/알류) ===
        "닭가슴살", "닭안심", "닭다리살", "계란", "메추리알", "오리고기",
        "소고기", "돼지고기",
        
        # === 3. 수산물 (오메가3 및 고단백) ===
        "고등어", "삼치", "연어", "참치", "오징어", "문어", "낙지",
        "새우", "굴", "전복", "장어", "황태", "조기", "갈치", "쭈꾸미",
        
        # === 4. 식물성 단백질 & 콩류 ===
        "두부", "연두부", "순두부", "두유", "콩물", "서리태", "검은콩", "낫또",
        
        # === 5. 채소 (식이섬유 & 비타민) ===
        "브로콜리", "시금치", "양배추", "당근", "양파", "오이", "상추", "깻잎",
        "파프리카", "피망", "가지", "호박", "애호박", "부추", "미나리",
        "아스파라거스", "케일", "셀러리", "숙주나물", "콩나물", "무", "배추",
        "여주", "돼지감자", # 당뇨/혈당 관리용
        
        # === 6. 버섯 & 해조류 (면역력 & 무기질) ===
        "새송이버섯", "팽이버섯", "표고버섯", "느타리버섯", "목이버섯",
        "미역", "다시마", "김", "파래", "매생이",
        
        # === 7. 과일 (비타민 & 항산화 - 당분 고려) ===
        "사과", "바나나", "토마토", "방울토마토", "블루베리", "딸기",
        "키위", "자몽", "오렌지", "귤", "수박", "참외", "배", "복숭아",
        "아보카도", "레몬", "라임",
        
        # === 8. 견과류/유제품/유지류 ===
        "아몬드", "호두", "캐슈넛", "땅콩", "피스타치오", "브라질너트",
        "우유", "저지방우유", "그릭요거트", "플레인요거트", "스트링치즈", "리코타치즈",
        "올리브유", "들기름", "참기름", "코코넛오일"
    ]
    
    loader.fetch_and_upload_from_api(target_foods)
    
    # ---------------------------------------------------------
    # 2. [CSV] 국민체력100 동영상 데이터 업로드
    # ---------------------------------------------------------
    print("\n[단계 2/2] 국민체력100 동영상 데이터 업로드")
    
    # data 폴더에 넣은 파일명을 정확히 적어주세요!
    video_filename = "서울올림픽기념국민체육진흥공단_국민체력100 운동처방 동영상주소 정보_20210727 (1).csv"
    
    loader.upload_video_csv_to_supabase(video_filename)
    
    print("\n" + "=" * 60)
    print("🎉 모든 데이터 업로드 작업이 완료되었습니다!")
    print("=" * 60)

if __name__ == "__main__":
    main()